version: '3.0'

services:
  minio:
    image: minio/minio:RELEASE.2020-04-15T19-42-18Z
    volumes:
      - ./data/minio:/data
    ports:
      - "9999:9000"
    environment:
      MINIO_ACCESS_KEY: minio
      MINIO_SECRET_KEY: minio123
    command: server /data
  postgres:
    image: postgres:9.6
    environment:
        - POSTGRES_USER=airflow # put your password
        - POSTGRES_PASSWORD=airflow # put your password
        - POSTGRES_DB=airflow
    logging:
        options:
            max-size: 10m
            max-file: "3"
  webserver:
    image: puckel/docker-airflow:1.10.9
    restart: always
    depends_on:
        - postgres
    environment:
        - LOAD_EX=n
        - EXECUTOR=Local
    logging:
        options:
            max-size: 10m
            max-file: "3"
    volumes:
        - ./airflow/dags:/usr/local/airflow/dags
        - ./airflow/plugins:/usr/local/airflow/plugins
    ports:
        - "8080:8080"
    command: webserver
    healthcheck:
        test: ["CMD-SHELL", "[ -f /usr/local/airflow/airflow-webserver.pid ]"]
        interval: 30s
        timeout: 30s
        retries: 3
